# v1.3.0 Universal Structure

**Release Date:** January 2026
**Branch:** v1.3.0
**Status:** In Development

## Overview

v1.3.0 introduces a universal navigation and branding system across all three scottbertrand.com domains (main site, Field Notes, Still Goods). This release replaces per-site branding with a unified "SB | SCOTT BERTRAND" text-based header and simplifies navigation by removing the Projects dropdown in favor of direct links.

## Key Changes

### 1. Universal Header

**Before:**
- Main site: SB monogram + "Scott Bertrand" wordmark (images)
- Field Notes: "Field Notes" logo (image)
- Still Goods: "Still Goods" logo (image)

**After:**
- All sites: Text-based "SB | SCOTT BERTRAND" (no images)
- Consistent branding across all three domains
- Simpler, faster-loading header

**Implementation:**
```html
<a href="https://scottbertrand.com/" class="site-brand">
    <span class="brand-text">SB | SCOTT BERTRAND</span>
</a>
```

**CSS:**
```css
.brand-text {
    font-size: 0.875rem;
    font-weight: 500;
    letter-spacing: 0.02em;
    color: var(--text-primary);
}
```

### 2. Universal Navigation

**Before:**
- 4 direct links + Projects dropdown (Field Notes, Still Goods, Max Stewart)
- Order: Services, How It Works, Projects (dropdown), About, Contact

**After:**
- 6 direct links (no dropdown)
- Order: Services, How It Works, About, Contact, Field Notes, Still Goods
- Consistent across all three sites

**Benefits:**
- Simpler navigation structure
- Faster to use (no hover/click for dropdown)
- Better mobile experience
- Easier to maintain

**Removed Files:**
- `dropdown.js` - No longer needed without Projects dropdown
- Script tags removed from all pages

### 3. Theme System Overhaul

**Major Changes:**

#### localStorage Key
- Changed from `theme` to `sb-theme` to prevent conflicts

#### Default Behavior
- **Before:** System preference (respects OS dark/light mode)
- **After:** Light mode default

#### System Mode Support
- New "system" mode option that listens to OS changes
- Three-way cycling: light → dark → system → light
- matchMedia listener for OS preference changes

#### FOUC Prevention
- Theme applied before DOM ready
- Prevents flash of wrong theme on page load

**Implementation:**
```javascript
class ThemeManager {
    constructor() {
        this.currentMode = this.getSavedMode(); // 'light', 'dark', or 'system'
        this.mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');
        this.init();
    }

    getSavedMode() {
        const saved = localStorage.getItem('sb-theme');
        return saved && ['light', 'dark', 'system'].includes(saved)
            ? saved
            : 'light'; // Default to light
    }

    cycleMode() {
        const modes = ['light', 'dark', 'system'];
        const currentIndex = modes.indexOf(this.currentMode);
        this.currentMode = modes[(currentIndex + 1) % modes.length];
        localStorage.setItem('sb-theme', this.currentMode);
        this.applyTheme();
    }

    applyTheme() {
        let effectiveTheme;
        if (this.currentMode === 'system') {
            effectiveTheme = this.mediaQuery.matches ? 'dark' : 'light';
        } else {
            effectiveTheme = this.currentMode;
        }
        this.html.setAttribute('data-theme', effectiveTheme);
        this.html.setAttribute('data-theme-mode', this.currentMode);
    }
}
```

**Data Attributes:**
- `data-theme`: The effective theme ('light' or 'dark')
- `data-theme-mode`: The user's mode choice ('light', 'dark', or 'system')

### 4. Hamburger-on-Overflow Responsive Nav

**Before:**
- Fixed breakpoint-based responsive behavior
- Hamburger appeared at predetermined screen sizes

**After:**
- ResizeObserver-based overflow detection
- Hamburger appears only when nav content would spill
- Content-aware responsive behavior

**Implementation:**
```javascript
class MenuManager {
    setupOverflowDetection() {
        const checkOverflow = () => {
            const navWidth = this.navMenu.scrollWidth;
            const containerWidth = this.navContainer.clientWidth;
            const isOverflowing = navWidth > containerWidth;

            if (isOverflowing) {
                this.navContainer.classList.add('nav--collapsed');
            } else {
                this.navContainer.classList.remove('nav--collapsed');
                this.closeMenu();
            }
        };

        const resizeObserver = new ResizeObserver(checkOverflow);
        resizeObserver.observe(this.navContainer);
        checkOverflow();
    }
}
```

**CSS:**
```css
/* Default: hamburger hidden, nav visible */
.hamburger {
    display: none;
}

/* When collapsed: hide nav, show hamburger */
.nav--collapsed .nav-menu {
    display: none;
}

.nav--collapsed .hamburger {
    display: flex;
}

/* When active: fullscreen overlay */
.nav--collapsed .nav-menu.active {
    display: flex;
    flex-direction: column;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--bg-primary);
    padding: 120px 2rem 2rem;
    z-index: 999;
    gap: 2rem;
}
```

**Features:**
- Click outside to close
- Escape key to close
- Proper ARIA attributes (`aria-expanded`, `aria-controls`)
- Automatic collapse/expand based on content width

## Files Changed

### Main Site (scottbertrand.com)
**Updated:**
- `index.html` - Homepage
- `about.html` - About page
- `approach.html` - Approach page
- `contact.html` - Contact page
- `field-note.html` - Field note template
- `field-notes.html` - Field notes archive
- `focus.html` - Focus page
- `how-it-works.html` - How it works page
- `request.html` - Service request form
- `services/brand-audit.html`
- `services/brand-reset.html`
- `services/full-brand-website-reset.html`
- `services/website-audit.html`
- `services/website-foundation.html`
- `styles.css` - Universal styles
- `theme.js` - Theme and menu management

**Removed:**
- `dropdown.js` - No longer needed
- Script tags for dropdown.js from all pages

### Still Goods Subdomain (goods.scottbertrand.com)
**Updated:**
- `index.html` - Homepage
- `about.html` - About page

**Note:** Cart button preserved in nav-utilities

### Field Notes Subdomain (notes.scottbertrand.com)
**Updated:**
- `index.html` - Archive page
- `field-note.html` - Entry template

## Migration Notes

### For Users
- Theme preference will reset to light mode on first visit after update
- Users who prefer dark mode will need to re-select it
- Users who want system mode can cycle through: light → dark → system

### For Developers
- Remove all `<script src="dropdown.js">` references
- Update header HTML across all pages
- Update theme.js to new implementation
- Test overflow detection on various screen sizes
- Verify ARIA attributes on hamburger button

## Testing Checklist

- [ ] All 14 main site pages render with universal header
- [ ] Still Goods pages render with universal header + cart button
- [ ] Field Notes pages render with universal header
- [ ] Theme toggle cycles: light → dark → system → light
- [ ] System mode respects OS preference changes
- [ ] No FOUC on page load
- [ ] Hamburger appears when nav overflows
- [ ] Hamburger hides when nav fits
- [ ] Click outside closes mobile menu
- [ ] Escape key closes mobile menu
- [ ] ARIA attributes update correctly
- [ ] All links work correctly (absolute URLs)
- [ ] Build succeeds without errors
- [ ] Vercel deployments succeed for all three domains

## Commits

1. **430256a** - `ui: implement universal header and navigation on homepage`
2. **05821a6** - `feat: overhaul theme system with light default and system mode`
3. **757acfa** - `ui: apply universal header to all main site pages`
4. **e598579** - `ui: apply universal header to Still Goods` (subdomain)
5. **0e9d62b** - `ui: apply universal header to Field Notes` (subdomain)

## Known Issues

None at this time.

## Future Considerations

- Consider adding breadcrumb navigation for deeper pages
- Consider adding "active" state styling for current page in nav
- May want to add transition animations for theme changes
- Consider accessibility audit for keyboard navigation

## Related Documentation

- [v1.2.0 Deployment](./v1.2.0-deployment.md)
- [v1.2.1 Navigation Update](./v1.2.1-navigation.md)
