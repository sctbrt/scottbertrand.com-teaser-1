# Version 4.0.1 Planning Document

**Scope:** Comprehensive audit and refinement across all three properties
**Focus Areas:** Navigation/header, animation system, forms/conversion
**Issue Types:** Performance, visual/design bugs, functional bugs, UX friction

---

## Executive Summary

This document outlines identified issues and recommended fixes across:
1. **scottbertrand.com** — Personal brand site (Vite)
2. **bertrandbrands.com** — Studio marketing site (Static)
3. **Bertrand Brands Internal System** — Dashboard/Portal (Next.js)

v4.0.1 is an incremental refinement of v4.0.0, focused on perfecting foundational elements rather than adding features.

---

## Property 1: scottbertrand.com

### Navigation/Header Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SB-NAV-01 | High | Backdrop-filter disabled when mobile menu opens causes visual flash | `styles.css:411-414` | Consider opacity transition on background instead of disabling filter entirely |
| SB-NAV-02 | Medium | `--opacity-*` variables referenced but not defined in styles.css | `styles.css:373`, etc. | Define in tokens or remove references |
| SB-NAV-03 | Low | Hamburger gap calculation uses hardcoded `32px` in JS | `theme.js:228` | Use CSS variable or computed style |

### Animation System Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SB-ANIM-01 | Medium | Staggered animations on `.section` elements fire on every page, not just initial load | `styles.css:148-166` | Add `.page-loaded` class check or use animation-fill-mode |
| SB-ANIM-02 | Low | `setInterval` for time-based theme runs even when in manual mode | `theme.js:91-98` | Clear interval when mode is not 'system' |

### Forms/Conversion Issues

> **Note:** scottbertrand.com is a personal brand hub, not a client conversion funnel. Form-related issues here are lower priority than on bertrandbrands.com.

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SB-FORM-01 | Low | Form success state only shows `.success-message` class but no JS handling visible | `styles.css:838-851` | Verify form submission handler exists (if forms are used) |
| SB-FORM-02 | Low | Select dropdown arrow hardcoded as SVG data URL | `styles.css:1594-1603` | Consider using CSS-only triangle or icon font |

### Performance Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SB-PERF-01 | Medium | Google Fonts imported via CSS `@import` (render-blocking) | `styles.css:7` | Move to `<link rel="preconnect">` + `<link>` in HTML |
| SB-PERF-02 | Low | Glass grain SVG texture regenerated on every render | `glass.css:178` | Consider CSS gradient alternative or cache |
| SB-PERF-03 | Low | ResizeObserver triggers on every frame during resize | `theme.js:276-279` | Add debounce/throttle |

### Visual/Design Bugs

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SB-VIS-01 | Medium | Dark mode dropdown shadow too harsh (`0.6` opacity) | `styles.css:1867` | Reduce to `0.4` for consistency with glass system |
| SB-VIS-02 | Low | Active nav underline opacity (`--opacity-low`) may be too subtle | `styles.css:403` | Consider `0.6` or higher |
| SB-VIS-03 | Low | Mobile menu padding inconsistent with desktop | `styles.css:477` | Align with design tokens |

---

## Property 2: bertrandbrands.com

### Navigation/Header Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-NAV-01 | High | Header visibility toggle uses inline JS-set opacity (not ideal for SSR/no-JS) | `index.html` (inline) | Use CSS class for visibility states |
| BB-NAV-02 | Medium | No mobile hamburger menu visible in current state | `index.html` | Verify mobile nav exists and works |
| BB-NAV-03 | Medium | Header ambient lighting (`--orange-pos-*`) hardcoded, no JS updates visible | `index.html:197-199` | Either remove dynamic vars or add JS driver |

### Animation System Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-ANIM-01 | Critical | Heavy spotlight animations (10+ keyframes) may cause jank on lower-end devices | `index.html` (inline CSS) | Add `will-change: transform, opacity` or reduce complexity on mobile |
| BB-ANIM-02 | High | `body:has(.intro:not(.intro--static))` selector not supported in older browsers | `index.html:279` | Add JS fallback for Safari < 15.4 |
| BB-ANIM-03 | Medium | Intro scroll lock (`overflow: hidden`) may cause scroll position jump | `index.html:279-281` | Use `position: fixed` + scroll restoration |
| BB-ANIM-04 | Medium | Spotlight convergence animations run infinitely | `index.html` | Add `animation-iteration-count` limit |
| BB-ANIM-05 | Low | Grid background animation opacity set to 1 but barely visible | `index.html:456-461` | Increase grid line opacity or remove |

### Forms/Conversion Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-FORM-01 | Critical | No visible form submission handling in `main.js` | `main.js` | Add fetch handler for `/api/notify` or verify HTML form action |
| BB-FORM-02 | High | Contact form success/error feedback divs reference but no show/hide logic | `index.html` | Add JS to toggle visibility on submit |
| BB-FORM-03 | Medium | Service select options may not reflect current pricing | `index.html` | Audit against Schema.org prices |

### Performance Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-PERF-01 | High | Entire 2000+ line CSS inlined in HTML | `index.html` | Consider extracting to external file for caching |
| BB-PERF-02 | Medium | Multiple Google Font families loaded (Fraunces, Inter, Source Serif 4) | `index.html:70` | Audit if all are used; subset if possible |
| BB-PERF-03 | Medium | Spotlight blur filter (`120px`) computationally expensive | `index.html:393` | Reduce blur radius or use simpler gradients |
| BB-PERF-04 | Low | No image optimization visible (`/public/assets/` empty) | N/A | Verify images are optimized WebP/AVIF |

### Visual/Design Bugs

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-VIS-01 | Medium | Intro logo mask animation may not work in Firefox | `index.html:473-534` | Add Firefox-specific fallback |
| BB-VIS-02 | Medium | Mobile spotlight position override uses fixed `margin-top: 100vh` | Recently added | Verify works across device heights |
| BB-VIS-03 | Low | Blue spotlight (`#2563eb`) contrast with orange may clash | `index.html:412` | Consider cooler blue or reduce intensity |

### Accessibility Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| BB-A11Y-01 | High | Heavy reliance on animations without `prefers-reduced-motion` fallbacks | `index.html` | Verify reduced-motion styles are comprehensive |
| BB-A11Y-02 | Medium | Missing `aria-label` on header logo link | `index.html` | Add descriptive label |
| BB-A11Y-03 | Medium | Form inputs missing explicit `<label>` associations | `index.html` | Add `for` attributes or wrap inputs |

---

## Property 3: Bertrand Brands Internal System

### Authentication Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SYS-AUTH-01 | Medium | Magic-link emails reference hardcoded "Bertrand Brands" branding | `lib/auth.ts` | Make branding configurable for future white-label |
| SYS-AUTH-02 | Low | 15-minute token expiry may be too short for slow email delivery | `lib/auth.ts` | Consider extending to 30 minutes |

### Forms/Conversion Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SYS-FORM-01 | High | Formspree webhook has extensive console logging in production | `api/intake/formspree/route.ts` | Remove or gate behind debug flag |
| SYS-FORM-02 | Medium | Lead conversion lacks confirmation modal | Dashboard leads | Add confirmation before creating client |
| SYS-FORM-03 | Medium | Invoice email templates have hardcoded portal URL | `lib/actions/invoices.ts` | Use environment variable |

### Performance Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SYS-PERF-01 | Low | Glass CSS imported globally even on non-glass pages | `globals.css:3` | Consider dynamic import or page-level import |
| SYS-PERF-02 | Low | Prisma client not optimized for edge runtime | `lib/prisma.ts` | Add connection pooling configuration |

### UX Friction Issues

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SYS-UX-01 | Medium | No loading states visible during form submissions | Dashboard/Portal | Add loading spinners to buttons |
| SYS-UX-02 | Medium | Error messages generic ("Something went wrong") | API routes | Implement structured error responses |
| SYS-UX-03 | Low | Activity log not visible in UI | Dashboard | Add activity feed component |

### Security Considerations

| ID | Priority | Issue | Location | Fix |
|----|----------|-------|----------|-----|
| SYS-SEC-01 | Medium | Rate limiting only on Formspree intake, not admin APIs | `api/` routes | Add rate limiting to admin endpoints |
| SYS-SEC-02 | Low | Vercel Blob URLs are public; signed URLs add layer but not foolproof | `lib/storage.ts` | Document security model clearly |

---

## Cross-Property Issues

### Design System Fragmentation

| ID | Priority | Issue | Fix |
|----|----------|-------|-----|
| CROSS-01 | High | Token definitions inconsistent across properties | Create shared `tokens.css` source-of-truth |
| CROSS-02 | High | Glass system implemented differently in each codebase | Standardize glass CSS; consider npm package |
| CROSS-03 | Medium | Accent color values vary slightly | Align to single `#D97706` / `#F59E0B` pair |
| CROSS-04 | Medium | Font loading strategy differs | Standardize preconnect + font-display approach |

### Navigation Patterns

| ID | Priority | Issue | Fix |
|----|----------|-------|-----|
| CROSS-05 | Medium | Mobile menu implementation differs between sites | Extract shared pattern |
| CROSS-06 | Low | Active state indicators inconsistent | Use same underline/highlight approach |

---

## Recommended Implementation Order

### Phase 1: Critical Fixes (Immediate)
1. BB-ANIM-01: Spotlight performance optimization
2. BB-FORM-01: Form submission handling
3. SYS-FORM-01: Remove production console logging
4. BB-ANIM-02: `:has()` selector fallback

### Phase 2: High Priority (Week 1)
1. SB-NAV-01: Backdrop-filter flash fix
2. BB-NAV-01: Header visibility CSS classes
3. BB-A11Y-01: Reduced motion comprehensive audit
4. BB-FORM-03: Client-side form validation (bertrandbrands.com)
5. CROSS-01: Token standardization

### Phase 3: Medium Priority (Week 2)
1. BB-PERF-01: Extract inline CSS
2. SB-PERF-01: Font loading optimization
3. SYS-UX-01: Loading states
4. CROSS-02: Glass system standardization
5. BB-FORM-02: Form feedback UI

### Phase 4: Polish (Ongoing)
1. All "Low" priority items
2. Documentation updates
3. Test coverage for form submissions
4. Performance profiling and optimization

---

## Testing Checklist

### Browser Matrix
- [ ] Chrome 120+ (primary)
- [ ] Safari 17+ (iOS/macOS)
- [ ] Firefox 121+ (fallback mode)
- [ ] Edge 120+

### Device Testing
- [ ] Desktop 1920×1080
- [ ] Desktop 1440×900
- [ ] Tablet 768×1024 (iPad)
- [ ] Mobile 390×844 (iPhone 14)
- [ ] Mobile 375×667 (iPhone SE)

### Accessibility
- [ ] VoiceOver (macOS/iOS)
- [ ] Keyboard navigation
- [ ] Reduced motion mode
- [ ] High contrast mode

### Performance
- [ ] Lighthouse score > 90 (all categories)
- [ ] First Contentful Paint < 1.5s
- [ ] Time to Interactive < 3s
- [ ] Animation frame rate > 55fps

---

## Notes

- CLAUDE.md specifies v1.5.1 for scottbertrand.com but this audit is for v4.0.1 ecosystem-wide
- bertrandbrands.com appears to be on a separate versioning track
- Internal system versioned at 0.1.0; consider aligning versioning strategy
- Consider creating monorepo structure for shared components/tokens

---

**Document Version:** 1.0
**Created:** 2026-01-27
**Author:** Claude Opus 4.5 (via Claude Code)
